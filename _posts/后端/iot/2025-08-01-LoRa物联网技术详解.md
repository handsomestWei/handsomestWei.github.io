---
title: LoRa物联网技术详解
date: 2025-08-01 16:00:00
categories: [后端, iot, lora]
tags: [后端, iot, lora]
image:
  path: /assets/img/posts/common/iot.jpg
---

# LoRa物联网技术详解
LoRa技术为物联网应用提供了可靠、高效的无线通信解决方案。

## LoRa基础概念

### 什么是LoRa
LoRa（Long Range）是一种**低功耗广域网（LPWAN）**技术，具有以下特点：

- **远距离传输**：1-10公里
- **低功耗**：电池可持续数年
- **低成本**：设备成本低
- **高容量**：支持大量设备接入

### 应用场景
- 智能抄表（水表、电表、燃气表）
- 环境监测（温湿度、空气质量）
- 农业物联网（土壤监测、灌溉控制）
- 工业监控（设备状态、能耗监测）
- 资产追踪

## LoRa协议数据流程
### 整体架构
```text
LoRa设备 → LoRa网关 → MQTT服务器 → 应用服务器
```

### 数据流向
上行数据（设备→服务器）
```text
LoRa设备 → LoRa网关 → MQTT主题: application/+/device/+/rx → 应用服务器
```
下行数据（服务器→设备）
```text
应用服务器 → MQTT主题: application/{applicationID}/device/{devEUI}/tx → LoRa网关 → LoRa设备
```
消息主题是LoRaWAN协议的标准规范。

### 数据报文
上行报文示例
```json
{
  "applicationID": "5",
  "deviceName": "custom-device",
  "devEUI": "00010117ff000bf4",
  "rxInfo": [
    {
      "gatewayID": "b827ebfffe619c43",
      "rssi": -70,
      "loRaSNR": 9.0
    }
  ],
  "txInfo": {
    "frequency": 472300000,
    "dr": 5
  },
  "fCnt": 1,
  "fPort": 223,
  "data": "BAAFAAAAAAAAAAAAAAAAIAEYAgAAADAAAFXwAAAAJgAAA0QD6BOIAAAAAA=="
}
```
字段说明如下，data内容属于私有协议，自行约定解析

| 字段 | 说明 | 示例值 |
|------|------|--------|
| applicationID | 应用ID | "5" |
| deviceName | 设备名称 | "kongtiaotest" |
| devEUI | 设备唯一标识 | "00010117ff000bf4" |
| gatewayID | 网关ID | "b827ebfffe619c43" |
| rssi | 信号强度 | -71 |
| loRaSNR | 信噪比 | 9.2 |
| frequency | 频率 | 472300000 |
| dr | 数据速率 | 5 |
| fCnt | 帧计数器 | 304 |
| fPort | 应用端口 | 223 |
| data | Base64编码数据 | "BAAFAAAA..." |

## LoRa网关作用
LoRa网关设备，在数据链路中非必须，设备也可不通过网关，直连服务器。
```text
LoRa设备 (1-10km) → LoRa网关 → 网络服务器 (全球)
     ↑                    ↑           ↑
   无线LoRa            网络转发     互联网
```

### 网关的双重角色
+ 无线接收端：网关接收LoRa设备的无线信号，通过LoRa射频模块接收无线信号，频率433MHz, 868MHz, 915MHz等，调制方式LoRa调制。
+ 网络发送端：网关将数据转发到网络服务器，通过以太网/WiFi/4G发送到MQTT服务器，协议如MQTT, HTTP, TCP等。

### 远距离传输关键
基于LoRa网关，能够实现**无线+网络**的组合，实现远距离传输。
1. **LoRa协议**：提供1-10公里的无线传输距离
2. **网关中继**：将无线信号转换为网络信号
3. **网络传输**：通过互联网实现全球传输

## 基于LoRa和LoRaWAN的无线物联网通信技术
LoRa处理的是物理的射频信号传输，LoRaWAN处理的是虚拟的网络协议逻辑，两者结合实现了无线物联网通信。
数据发送过程：
```text
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ LoRaWAN协议 │ -> │ LoRa调制    │ -> │ 射频信号    │
│ (网络层)    │    │ (物理层)    │    │ (物理传输)  │
└─────────────┘    └─────────────┘    └─────────────┘
    虚拟协议           物理技术          物理电磁波
```

### LoRa调制技术
+ 是一种物理层的调制技术（类似FM、AM），不是协议。
+ 提供物理层通信能力。数据传输基于物理的电磁波信号。
+ 可以传输任意数据格式

#### 信息编码过程
信息编码方式：
```text
数字信号 → 模拟信号 → 电磁波调制 → 空间传播
```
改变载波的特性，绘制出特定规律的波形图（AM振幅、FM频率等），来编码信息。对电磁波信息编码过程：
```text
原始数据: "101" → 载波生成: 868MHz纯净正弦波 → 调制过程: 根据数据改变载波特性 → 调制信号: 包含"101"信息的电磁波 → 天线发射: 辐射到空间 → 空间传播: 电磁波传播 → 天线接收: 接收调制信号 → 解调过程: 从载波中提取数据 → 恢复数据: "101"
```

#### 无线通信基本原理
电磁波由电场和磁场组成。电磁波的基本特性包含频率、波长、振幅、相位。本质是电场和磁场的振荡，是能量在空间中的传播。
+ 载波：原始的没有包含任何信息的电磁波。
+ 调制：遵循特定协议，把报文信息编码到波里，产生特定规则的波形。接收端可以解码。
可以通过改变扩频因子和带宽来编码信息，使用更复杂的调制方式，提升抗干扰能力。

### LoRaWAN网络协议
+ 是建立在LoRa之上的网络协议
+ 定义了设备管理、安全、路由等
+ 标准化了消息格式和流程

#### 协议规范
| 字段 | LoRaWAN标准 |
|------|-------------|
| devEUI | 设备唯一标识 |
| applicationID | 应用标识 |
| fCnt | 帧计数器 |
| fPort | 应用端口 |
| data | 载荷数据 |
